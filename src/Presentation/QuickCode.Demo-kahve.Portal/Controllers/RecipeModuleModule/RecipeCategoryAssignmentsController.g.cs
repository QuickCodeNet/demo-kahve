//------------------------------------------------------------------------------ 
// <auto-generated> 
// This code was generated by QuickCode. 
// Runtime Version:1.0
// 
// Changes to this file may cause incorrect behavior and will be lost if 
// the code is regenerated. 
// </auto-generated> 
//------------------------------------------------------------------------------
using System;
using System.Collections.Generic;
using System.Linq;
using QuickCode.Demo-kahve.Portal.Models; using  QuickCode . Demo
-kahve.Portal.Models.RecipeModuleModule; using  QuickCode . Demo
-kahve.Portal.Helpers; using  Microsoft . AspNetCore . Mvc ;  using  IdentityModuleContracts  =  QuickCode . Demo
-kahve.Common.Nswag.Clients.IdentityModuleApi.Contracts; using  RecipeModuleModuleContracts  =  QuickCode . Demo
-kahve.Common.Nswag.Clients.RecipeModuleModuleApi.Contracts; using  System . IO ;  using  Microsoft . AspNetCore . Authorization ;  using  QuickCode . Demo
-kahve.Portal.Helpers.Authorization; using  Microsoft . AspNetCore . Http ;  using  System . Threading ;  using  System . Threading . Tasks ;  using  AutoRest . Core . Utilities . Collections ;  using  Microsoft . Extensions . Caching . Memory ;  using  Microsoft . AspNetCore . Mvc . Rendering ; 
namespace QuickCode.Demo - kahve . Portal . Controllers . RecipeModuleModule {
    [Permission("RecipeModuleModuleRecipeCategoryAssignments")]
    [Area("RecipeModuleModule")]
    [Route("RecipeModuleModuleRecipeCategoryAssignments")]
    public partial class RecipeCategoryAssignmentsController : BaseController
    {
        private readonly RecipeModuleModuleContracts.IRecipeCategoryAssignmentsClient pageClient;
        private readonly RecipeModuleModuleContracts.IRecipesClient pageRecipeClient;
        private readonly RecipeModuleModuleContracts.IRecipeCategoriesClient pageRecipeCategoryClient;
        public RecipeCategoryAssignmentsController(RecipeModuleModuleContracts.IRecipeCategoryAssignmentsClient pageClient, RecipeModuleModuleContracts.IRecipesClient pageRecipeClient, RecipeModuleModuleContracts.IRecipeCategoriesClient pageRecipeCategoryClient, IdentityModuleContracts.ITableComboboxSettingsClient tableComboboxSettingsClient, IHttpContextAccessor httpContextAccessor, IMemoryCache cache) : base(tableComboboxSettingsClient, httpContextAccessor, cache)
        {
            this.pageClient = pageClient;
            this.pageRecipeClient = pageRecipeClient;
            this.pageRecipeCategoryClient = pageRecipeCategoryClient;
        }

        [ResponseCache(VaryByQueryKeys = new[] { "ic" }, Duration = 30)]
        public async Task<IActionResult> GetImage(string ic)
        {
            return await GetImageResult(pageClient, ic);
        }

        [Route("List")]
        public async Task<IActionResult> List()
        {
            var model = await PrepareModel();
            model.ComboList = await FillPageComboBoxes(model.ComboList);
            SetModelBinder(ref model);
            return View("List", model);
        }

        [Route("List")]
        [HttpPost]
        public async Task<IActionResult> List(RecipeCategoryAssignmentData model)
        {
            ModelBinder(ref model);
            model = await PrepareModel(model);
            model.SelectedItem = new();
            SetModelBinder(ref model);
            return View("List", model);
        }

        [Route("Insert")]
        [HttpPost]
        public async Task<IActionResult> Insert(RecipeCategoryAssignmentData model)
        {
            ModelBinder(ref model);
            var result = await pageClient.RecipeCategoryAssignmentsInsertAsync(model.SelectedItem);
            ClearCache();
            SetModelBinder(ref model);
            return Ok(result);
        }

        [Route("Update")]
        [HttpPost]
        public async Task<IActionResult> Update(RecipeCategoryAssignmentData model)
        {
            ModelBinder(ref model);
            var request = model.SelectedItem;
            var result = await pageClient.RecipeCategoryAssignmentsUpdateAsync(request.Id, request);
            ClearCache();
            SetModelBinder(ref model);
            return Ok(result);
        }

        [Route("Delete")]
        [HttpPost]
        public async Task<IActionResult> Delete(RecipeCategoryAssignmentData model)
        {
            ModelBinder(ref model);
            var request = model.SelectedItem;
            var result = await pageClient.RecipeCategoryAssignmentsDeleteAsync(request.Id);
            ClearCache();
            SetModelBinder(ref model);
            return Ok(result);
        }

        [Route("InsertItem")]
        public IActionResult InsertItem(RecipeCategoryAssignmentData model)
        {
            ModelState.Clear();
            ModelBinder(ref model);
            SetModelBinder(ref model);
            model.SelectedItem = new();
            return PartialView("Insert", model);
        }

        [Route("DetailItem")]
        public async Task<IActionResult> DetailItem(RecipeCategoryAssignmentData model)
        {
            ModelBinder(ref model);
            model = await PrepareModel(model);
            model.SelectedItem = model.List.Find(i => i.GetKey() == model.SelectedKey);
            SetModelBinder(ref model);
            return PartialView("Detail", model);
        }

        [Route("UpdateItem")]
        [HttpPost]
        public async Task<IActionResult> UpdateItem(RecipeCategoryAssignmentData model)
        {
            ModelState.Clear();
            ModelBinder(ref model);
            model = await PrepareModel(model);
            model.SelectedItem = model.List.Find(i => i.GetKey() == model.SelectedKey);
            SetModelBinder(ref model);
            return PartialView("Update", model);
        }

        [Route("DeleteItem")]
        [HttpPost]
        public async Task<IActionResult> DeleteItem(RecipeCategoryAssignmentData model)
        {
            ModelBinder(ref model);
            model = await PrepareModel(model);
            model.SelectedItem = model.List.Find(i => i.GetKey() == model.SelectedKey);
            SetModelBinder(ref model);
            return PartialView("Delete", model);
        }

        private async Task<RecipeCategoryAssignmentData> PrepareModel()
        {
            var model = GetModel<RecipeCategoryAssignmentData>();
            model.CurrentPage = 1;
            model.PageSize = PageSize;
            return await PrepareModel(model);
        }

        private async Task<RecipeCategoryAssignmentData> PrepareModel(RecipeCategoryAssignmentData model)
        {
            model.NumberOfRecord = await pageClient.RecipeCategoryAssignmentsCountAsync();
            model.TotalPage = (model.NumberOfRecord + PageSize - 1) / PageSize;
            model.List = (await pageClient.RecipeCategoryAssignmentsListAsync(model.CurrentPage, PageSize)).ToList();
            return model;
        }

        private async Task<Dictionary<string, Dictionary<string, string>>> FillPageComboBoxes(Dictionary<string, Dictionary<string, string>> comboBoxList)
        {
            comboBoxList.Clear();
            comboBoxList.AddRange(await FillComboBoxAsync("Recipes", () => pageRecipeClient.RecipesListAsync()));
            comboBoxList.AddRange(await FillComboBoxAsync("RecipeCategories", () => pageRecipeCategoryClient.RecipeCategoriesListAsync()));
            return comboBoxList;
        }
    }
}